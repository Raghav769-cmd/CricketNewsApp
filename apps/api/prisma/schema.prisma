generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Team {
  id        Int     @id @default(autoincrement())
  name      String
  players   Player[]
  matches1  Match[] @relation("team1")
  matches2  Match[] @relation("team2")
  matchWins Match[] @relation("winner")
  overs     Over[]
  playerStats PlayerStats[]

  @@map("teams")
}

model Player {
  id            Int     @id @default(autoincrement())
  name          String
  teamId        Int
  team          Team    @relation(fields: [teamId], references: [id])
  overs         Over[]
  balls_batsman Ball[] @relation("batsman")
  balls_bowler  Ball[] @relation("bowler")
  playerStats   PlayerStats[]
  playerDescriptions PlayerDescription[]

  @@map("players")
}

model Stadium {
  id        Int     @id @default(autoincrement())
  name      String
  city      String?
  country   String?
  capacity  Int?
  matches   Match[]

  @@map("stadiums")
}

model Match {
  id                  Int     @id @default(autoincrement())
  team1Id             Int
  team2Id             Int
  stadiumId           Int?
  format              String?
  oversPerInning      Int?
  status              String?
  inning1Complete     Boolean @default(false)
  inning2Complete     Boolean @default(false)
  inning3Complete     Boolean @default(false)
  inning4Complete     Boolean @default(false)
  winnerId            Int?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @default(now()) @updatedAt
  
  team1               Team    @relation("team1", fields: [team1Id], references: [id])
  team2               Team    @relation("team2", fields: [team2Id], references: [id])
  stadium             Stadium? @relation(fields: [stadiumId], references: [id])
  winner              Team?   @relation("winner", fields: [winnerId], references: [id])
  overs               Over[]
  playerDescriptions  PlayerDescription[]

  @@map("matches")
}

model Over {
  id              Int     @id @default(autoincrement())
  matchId         Int
  inningNumber    Int?
  overNumber      Int?
  bowlerId        Int?
  battingTeamId   Int?
  createdAt       DateTime @default(now())
  
  match           Match   @relation(fields: [matchId], references: [id])
  bowler          Player? @relation(fields: [bowlerId], references: [id])
  battingTeam     Team?   @relation(fields: [battingTeamId], references: [id])
  balls           Ball[]

  @@map("overs")
}

model Ball {
  id          Int     @id @default(autoincrement())
  overId      Int
  ballNumber  Int?
  batsmanId   Int?
  bowlerId    Int?
  runs        Int     @default(0)
  extras      String?
  event       String?
  isWicket    Boolean @default(false)
  dismissal   String?
  createdAt   DateTime @default(now())
  
  over        Over    @relation(fields: [overId], references: [id])
  batsman     Player? @relation("batsman", fields: [batsmanId], references: [id])
  bowler      Player? @relation("bowler", fields: [bowlerId], references: [id])

  @@map("balls")
}

model PlayerStats {
  id              Int     @id @default(autoincrement())
  playerId        Int
  teamId          Int
  format          String
  matchesPlayed   Int     @default(0)
  runsScored      Int     @default(0)
  ballsFaced      Int     @default(0)
  fours           Int     @default(0)
  sixes           Int     @default(0)
  centuries       Int     @default(0)
  halfCenturies   Int     @default(0)
  highestScore    Int     @default(0)
  timesOut        Int     @default(0)
  wicketsTaken    Int     @default(0)
  runsConceded    Int     @default(0)
  oversBowled     Decimal @default(0)
  bestBowling     String  @default("0/0")
  maidens         Int     @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt
  
  player          Player  @relation(fields: [playerId], references: [id])
  team            Team    @relation(fields: [teamId], references: [id])

  @@unique([playerId, teamId, format])
  @@map("player_stats")
}

model PlayerDescription {
  id          Int     @id @default(autoincrement())
  matchId     Int
  playerId    Int
  description String?
  author      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt
  
  match       Match   @relation(fields: [matchId], references: [id])
  player      Player  @relation(fields: [playerId], references: [id])

  @@unique([matchId, playerId])
  @@map("player_descriptions")
}

model RegularUser {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  name      String?
  username  String  @unique
  createdAt DateTime @default(now())

  @@map("regular_users")
}

model Admin {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  name      String?
  username  String  @unique
  role      String?
  createdAt DateTime @default(now())

  @@map("admins")
}

model AdminRequest {
  id                Int     @id @default(autoincrement())
  email             String
  password          String
  name              String?
  username          String
  status            String  @default("pending")
  requestedByEmail  String?
  role              String?
  createdAt         DateTime @default(now())

  @@map("admin_requests")
}
